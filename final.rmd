---
title: Morphometric properties of shallow water kelp, Ecklonia maxima, along thermal
  and wave exposure gradients.
author: "Jesse Smith"
date: "November 2018"
Project Supervisor: Prof AJ Smit
Assistant Supervisor: Ross Coppin
output: 
  pdf_document: 
    fig_cap: yes
    keep_tex: yes
    latex_engine: xelatex
  word_document: default
  html_document: 
    df_print: paged
mainfont: Arial
monofont: PT Mono
header-includes: 
- \usepackage{float}
- \floatplacement{figure}{H}
fontsize: 12pt
---

```{r}
knitr::opts_chunk$set(echo = TRUE, fig.pos = "h")
```

\newpage
## Abstract


\newpage
---
## Introduction 

Kelps often congregate in populations known as kelp forests and are found in temperate and polar coastal regions and are amongst the most productive ecosystems in the world (Mann, 1973; Fredriksen, 2003; Rysgaard and Nielsen, 2006; Merzouk, 2011, Bolton 2010, Lüning 1990, Kain 1979, Steneck and Johnson 2013), especially  in areas of frequent upwelling (Druehl 1981). The rich biodiversity of kelp forests allow for a number of food webs and trophic levels to exist. Kelps form the basis of some of these food webs, and are important primary producers, as they supply herbivores, detritivores and microbes with vital nutrients. These underwater forests also provide shelter, food and are nursery grounds for various marine species (Anderson 1997, Steneck 2002, Merzouk, 2011). Kelp is considered as an ecosystem engineer, and is important in ecosystem functioning, providing ecosystem services that include purifying and removing waste produced by organisms living within the forests. 

Many environmental factors influence kelp bed communities, where temperature drives the geographical distribution of marine organisms (Lüning 1990, Rothman 2015). This biogeographical range is largely determined by the kelp species tolerance of high summer maxima and low winter minima temperatures (Luning, 1984; van den Hoek and Luning, 1988; van den Hoek et al., 1990; Adey and Steneck, 2001) However, for kelp beds, many other factors determine their distribution, these include: wave action, grazing (McQuaid and Branch 1984; Kalvas and Kautsky, 1993, Wernberg & Goldberg 2008, Bekkby et al. 2009), nutrient concentrations, photoperiod (Luning 1980, 1990), tides, topography of substrata (Fowler-Walker and Connell 2007, Bekkby et al. 2009) and depth, among other ecological factors. Depth is a proxy for light attenuation (Luning 1990, Bekkby et al 2009) making it (depth) a major regulatory factor in the vertical distribution of kelp.

South Africa is bordered by two large intricate currents, the warm tropical Agulhas current on the east coast (Beal et al. 2011, Rouault et al. 2010, Schumann 1988, De Clerck et al. 2005), and the northward flowing cold nutrient rich Benguela on the west coast (Andrews and Hutchings 1980, Shannon 1985, Shannon and Pillar 1986), thus interaction of these two currents have profound effects on marine life (Partridge et al. 2004, Schmitz 1995, Shillington et al. 2006, Walker 1990). South Africa is unique in that the interaction of these currents occurs over a relatively short spatial scale at the south western coast, between Cape Point and Cape Agulhas. This interaction results in a large temperature gradient along the shore (Smit et al. 2013, 2017). These large temperature gradients have shown to diminish kelp distribution (Bolton, 2010). The west coast proves to be an ideal location for the growth of kelp, due to the intense upwelling conditions experienced in summer (Field et al, 1980, 1981). The upwelling of deep cold water brings with it nutrients which allow life to proliferate. However, it comes at a cost; upwelling results in a more turbid environment, drastically reducing light levels (Anderson, 1982). Light and nutrients are both limiting factors for the optimal growth of kelp, and studies by Luning and Neushul (1978), and Luning (1980), showed that due to insufficient light and nutrients, growth and reproduction rates were reduced in Laminarian species. 

Ecklonia maxima,(Osbeck) Papenf. is a species of large brown kelp from the order Laminariales; it is characterised by a long hollow stipe, a spear-shaped primary blade, and secondary blades that grow bilaterally. It is the more dominant species of the four kelp species (Ecklonia maxima, Laminaria pallida, Macrocystis pyrifera and Ecklonia radiata) found along the coast of Southern Africa. The former three species form dense beds in the cold nutrient rich waters of the Benguela Marine Province and the Benguela-Agulhas Transition Zone (Bolton 2012), while E. radiata inhabits the warmer east coast of South Africa. E. maxima forms a floating canopy up to depths of 19m and L. pallida forms the sub-canopy at depths generally greater than that of the former species. (more citations)
E. maxima occurs in areas of warm to cold temperate waters in the sub- and intertidal rocky substrate (Stenek and Johnson 2013, Rothman 2015), and its biogeographical range extends from north of Lüderitz, Namibia to west of Cape Agulhas in South Africa (Bolton1985; Probyn1985; Bolton1987; Bolton2012). Previously described as a cold water species by Griffiths and Mead (2011), E. Maxima has since been reclassified as a warm temperate water species since it is found in False Bay, in the Benguela-Agulhas Transition zone, where monthly mean temperatures in summer exceed 18 °C (Bolton 2012). False Bay’s high summer temperatures are a result of solar heating of entrained water (Anderson et al. 1997) by the strong south easterly wind, affectionately named the Cape Doctor (Gyory et al ), blowing the warm Agulhas current into the bay. The same south easterly wind moves up over Table Mountain and blows the surface water offshore, allowing cold, nutrient rich water to be upwelled to the surface, promoting primary productivity (Boyer et al. 2000, Skogen 1999).

Many studies have stated that wave exposure is the most identified cause of morphological variation in kelp (Gerard and Mann, 1979; Cousens, 1982; Cheshire and Hallam, 1988; Molloy and Bolton, 1996; Ralph et al., 1998; Hurd, 2000; Blanchette et al., 2002; Roberson and Coyer, 2004), while Koehl (1986), Wheeler (1988), Hurd (2000) and Wernberg and Thomsen 2005) demonstrated that wave exposure affects many of the morphological characteristics in kelp.  Because wave climates can statistically and physically be described by a suite of wave parameters, it is probable that each wave metric would interaction different morphological variables would respond differently to each parameter. Generally, kelp growing in exposed areas is tougher, sturdier, and more strongly attached than those in sheltered areas (Wernberg and Thomsen, 2005). Frond characteristics of kelp in exposed areas are narrow, thick, flat and smooth, whereas those in sheltered areas have blades that are wide and thin with ruffled margins (Wernberg and Thomsen, 2005). 

Wernberg and Thomsen (2005) observed that Ecklonia radiata responded to intense wave exposure by having small narrow blades (Gerard 1987) with minimal spinosity to reduce drag, as well as larger holdfasts (Sjøtun and Fredriksen, 1995), thicker stipes (Cheshireand Hallam, 1988; Klinger and DeWreede, 1988) and thicker lamina (Cheshire and Hallam, 1988; Molloy and Bolton, 1996; Kawamata, 2001) for increased strength. Morphological adaptations are beneficial for mortality (Friedland and Denny, 1995; Blanchette et al., 2002, Wernberg and Thomsen, 2005) but are consequential in that it reduces rates of photosynthesis, productivity and growth (Gerard and Mann, 1979; Jackelman and Bolton, 1990; Blanchette et al., 2002, Wernberg and Thomsen, 2005). Kelp needs to be flexible, to resist hydrostatic bending forces (Norton et al. 1982). It was suggested that kelp flexibility in the stipes might be related to wave exposure, especially in shallow water, implying that the kelp strategy for survival in high water motion environments is flexibility rather than strength and resistance (Rothman, 2015).

Since the temperature and wave climate that affect kelp distribution and morphology are subject to climatic change, it is not unreasonable to surmise that this changing climate might have consequences for the ecology of kelp beds. The Agulhas current system has warmed significantly (1.5°C in 20 years) and a decrease in sea surface temperature (up to 0.5°C per decade) has been observed along the East Coast, near Port Alfred and in Algoa Bay (Port Elizabeth) (Rouault et al. 2009, Rouault et al. 2010, and Rouault et al. 2011). Bolton (2012) suggested that there is a high probability that kelp abundance increased (1986-2007) along the west coast of South Africa, where water temperatures are getting cooler. In addition, the altered wind and rainfall patterns change the intensity of the Benguela upwelling system (Rouault et. al 2010).

Kelp are an important indicator of change as they are extremely responsive to environmental conditions and are very exposed to human activities such as harvesting, pollution, recreational fishing and sedimentation, which impact on the coastal zone (Krumhansl et al. 2016). Increased sea surface temperatures could result in a loss of abundance and alter the range of this keystone species (Merzouk 2011), resulting in changes in the community structure of marine organisms living within the kelp beds. 

The distribution of kelps range across vast hydrodynamic environments and therefore they present an array of morphological variation (Johnson and Koehl 1994; Roberson and Coyer 2004; Wernberg and Vanderklift 2010). It is therefore to be determined how environmental factors such as temperature and wave exposure influence or affect the morphology of shallow water E. maxima. This will be accomplished by understanding how the various aspects of kelp morphology and environmental parameters differ at various sites along the Cape Peninsula. The parameters of temperature and wave exposure will also be investigated to identify which parameters can best explain the morphological variation in the different kelp communities. Based on previous studies it is hypothesised that populations with similar temperature and wave exposure regimes will have similar morphologies and that temperature will influence morphological variables related to nutrient uptake, whereas wave exposure will influence morphology of the fronds. 

\newpage
## Methods 

### Study Area

Sites were selected according to the geographic distribution of _E. maxima_, under varying levels of wave exposure and temperature regimes along the south west coast of South Africa. This region experiences  The chosen sites are along the West Coast and False Bay regions, from St. James in False Bay to Yzerfontein on the West Coast. 

```{r}
# load libraries

library(ggplot2)
library(ggmap)
library(maps)
library(dplyr)
library(mapdata)
library(mapproj)

# load data ---------------------------------------------------------------
site_list <- read.csv("D:/honours/honours-project/data/sites_fin.csv", sep=";")

# slice "selects rows" as select "selects columns"

false_bay_sites <- site_list %>% 
  slice(c(1,5:7,11:15))

west_coast_sites <- site_list %>% 
  slice(c(2:4,8:10,16))

# load map of cape point
load("data/cape_point.RData")

ggmap(cape_point)

cp1 <- ggmap(cape_point) +
  geom_point(data = site_list, aes(x = long , y = lat ), 
             colour = "red", size =  2.5) +
  labs(x = "Latitude(°E)", y = "Longitude(°S)", title = "Site Map") 

cp2 <- cp1 +
  geom_text(data = false_bay_sites,
            aes(long, lat, label = site), 
            hjust = 0, vjust = 0.7, 
            size = 4, colour = "white") + 
  geom_text(data = west_coast_sites,
            aes(long, lat, label = site), 
            hjust = 1.05, vjust = 0.7, 
            size = 4, colour = "white") +
  annotate("text", label = "False Bay", 
                      x = 18.7 , y = -34.3,
                      size = 5, colour = "salmon")+
  annotate("text", label = "West Coast", 
           x = 18.1 , y = -34.3,
           size = 5, colour = "salmon")+
  theme_bw()+
  coord_cartesian()

cp2

# Yzerfontein -------------------------------------------------------------

yzerfontein <- get_map(location = c(lon = 18.14726, lat = -33.35357),
                       zoom = 10, maptype = 'satellite')

ggmap(yzerfontein)

yzer1 <- ggmap(yzerfontein) +
  geom_point(data = site_list, aes(x = lon , y = lat ),
             colour = "red", size =  2.5) +
  labs(x = "Latitude(°E)", y = "Longitude(°S)", title = "Yzerfontein")

yzer2 <- yzer1 +
    annotate("text", label = "18.15°E, -33.35°S",
           x = 18.14726 , y = -33.35357,
           size = 3, colour = "salmon") +
  theme_void() +
  theme( panel.border = element_rect(colour = "white", fill=NA, size=5)) +
  coord_cartesian()

yzer2

# final site map  ---------------------------------------------------------

final_sitemap <- cp2 +
  annotation_custom(grob = ggplotGrob(yzer2),
                    xmin = 18.0, xmax = 18.2,
                   ymin = -33.9, ymax = -34.1)
 
final_sitemap

```

\newpage
###	Morphometric data collection 

Sampling took place between March and October 2018 during low tide. The thirteen largest Ecklonia maxima individuals were collected by snorkel in an area where the kelp bed was ~1m deep and in shallow water (along the shoreline). Juvenile kelp (juvenile sporophytes) of about 30cm in length were collected. After collection, various morphological and biomass measurements were recorded.

Table of morphological measurements, units and procedures: 
```{r}

library(knitr)

a <- c("Primary blade length","Primary blade width","Frond length","Stipe length","Stipe circumference","Number of tufts","Epiphyte length","Frond mass","Stipe mass")
b <- c("cm","cm","cm","cm","cm","N/A","cm","kg","kg")
c <- c("From where the stipe widens and flattens into frond at distal end of primary blade",
       "At maximum", "Longest frond", "From directly above the holdfast to where stipe widens and flattens into frond", "At widest point (around pneumatocyst)", "No. of points at which secondary blades branchs off primary blade", "Presence/absence", "Total mass of fronds from base of primary blade", "Total mass of stipe (see stipe length)")

measurements <- data.frame(Morphological_measurement = a, Units = b, Procedure = c)

kable(measurements, row.names = FALSE, caption = "A list of morphological measurements, unit and procedures of _Ecklonia maxima _ that were collected.")

```

```{r echo=FALSE, fig.cap="Annotated diagram of a _Ecklonia maxima_ sporophyte", fig.height=40, fig.width=5}

library(png)
library(grid)

kelp <- readPNG("kelp.png")
grid.raster(kelp)

```

\newpage
### Abiotic parameters

####Temperature data

The monthly shallow water temperature data was obtained from the South African Coastal Temperature Network (SACTN) web interface (https://robert-schlegel.shinyapps.io/SACTN/).The temperature dataset was a compilation of contributions made by several sources, using in situ data and digital underwater temperature recorders (UTRs). The thermal parameters used were minimum temperature, maximum temperature and mean temperature.

#### Wave Parameters 

All wave data, taken at three hour resolutions, were obtained from the South African Weather Service (SAWS). The wind and wave parameters measured were; wave height (hs), wave period (tp), wave direction (dir), wind direction (dirw) and wind speed (spw). Short-crested waves, generated by wind into the coastal environment (Booij et al., 1997) were modelled from the data using the Simulating Waves in the Nearshore (SWAN) model (Booij et al., 1997). SWAN enables the removal of wave parameters from particular gridded locations in the nearshore. For this study, a 200 m alongshore resolution was used, at both the 7 and 15 meter isobaths.

### Statistical Methods 

Tests, _specify_ for normality were performed, and due to the morphological and temperature data not being normally distributed, non-parametric analyses _such as.._  were subsequently performed. The morphometric data were then standardised to a mean of 0 and a standard deviation of 1 in order to easily compare variables measured on different scales.

A descriptive summary of the temperature and wave data was also conducted, including statistics such as minimum, maximum, mean, range and standard deviation. This was used to determine the monthly and annual climatologies of the sites sampled. These climatologies were used in the redundancy analysis (RDA) to identify the parameters of temperature and wave exposure which are the most influential in kelp morphology. RDAs help to summarise the variation in response variables (morphometric measurements), that is explained by explanatory variables (temperature and wave exposure parameters). This is achieved by performing multiple linear regressions between the response and explanatory variables. 

All statistical analyses were conducted using R 3.5.1 (R Core Team 2018). 

\newpage
## Results 

Morphology results:
```{r}
# load libraries  
library(tidyverse)
library(ggpubr)
library(dplyr) #for filter and %>%  command
library(readr) #read csv
library(ggplot2)
library(vegan)

# load data 
# loading data about the morphometric properties of _Ecklonia maxima_ 
morph <- as.tibble(read_csv("D:/honours/honours-project/data/morph_update.csv")[, -14])
# the column epiphyte length was removed, as it was inconsistently measured at some sites, and not measured at all at other sites. 

# standardise data 
# create numerical df to be standardized 
morph.std <- morph %>% 
  select(-date, -site, -depth, -ind, -fertile) 

morph.stand <- decostand(morph.std, method = "standardize")

# create df with non numerical cols
df_char <- morph %>% 
  select(date:fertile)

# combine standardized data with character df
df <- cbind(df_char, morph.stand) %>% 
  filter(depth == "deep/adult")

# summarise morph 
sum.morph <- morph %>%
  group_by(as.factor(site)) %>%   
  summarise(mn_fr_mass = mean(frond_mass), 
            sd_fr_mass = sd(frond_mass),
            mn_pri_len = mean(primary_length),
            sd_pri_len = sd(primary_length), 
            mn_pri_wid = mean(primary_width),
            sd_pri_wid = sd(primary_width), 
            mn_fr_len = mean(frond_length),
            sd_fr_len = sd(frond_length),
            mn_st_mass = mean(stipe_mass),
            sd_st_mass = sd(stipe_mass), 
            mn_st_len = mean(stipe_length),
            sd_st_len = sd(stipe_length), 
            mn_st_circ = mean(stipe_circ), 
            sd_st_circ = sd(stipe_circ),
            mn_tufts = mean(tufts), 
            sd_tufts = sd(tufts),
            mn_total_len = mean(total_length), 
            sd_total_len = sd(total_length))

# boxplots on standardized data 
# convert wide data to long data 
morph_long <- df %>% 
  gather(key = "variable", value = "value", -site, -ind, -date, -depth, -fertile)  

# figure 1
# visualising data 
ggplot(data = morph_long, aes(x = "", y = value, fill = site)) +
  geom_boxplot(notch = TRUE) +
  facet_wrap( ~ variable, scales = "free") +
  labs(title = "Fig 1: Morphological variables of _E.maxima_ collected at 1m depth.") +
  theme_classic()

```

Frond length showed no specific pattern in geographic location among the sites. Both west coast and False Bay sites had variable frond lengths. Kalk Bay and Soetwater both had significantly shorter frond lengths than the other sites displayed. Olifantsbos, St James North, Yzerfontein and Oudekraal showed the largest variability in frond lengths when comparing the descriptive statistical boxplots. Frond mass however, displayed large variability at Oudekraal, St James and Yzerfontein and Kommetjie, with the former three sites having lager masses than that of Kommetjie. All other sites had relatively low variability and lighter frond mass. Sites located fairly close together such as Miller’s Point (including Miller’s A, B and C), St. James north and St. James South, and Black Rocks and Buffels, showed no significant difference in frond mass compared to each other. Stipe length displayed the most variability among sites, irrespective of the proximity of their locations. False Bay sites generally have longer stipes than sites along the west coast. Stipe mass is fairly similar across all sites. Stipe circumference is rather similar for all sites except Bakoven on the west coast and Kalk Bay in False Bay.The primary blades of E. maxima have high variability in their lengths, with longer primary blades found along the west coast, especially at olifantsbos, Oudekraal and Slangkop.

Comparing the morphology of _E.maxima_ at three depths:
```{r}
# depth classes 
# shallow/juvenile : juvenile E.maxima with stipe lengths of about 30cm, in very shallow water
# shallow/adult : largest adult E.maxima individuals found in very shallow water 
# deep/adult : largest adult E.maxima individuals found at 1m depth 

compare <- cbind(df_char, morph.stand) %>% 
  filter(date == "12-09-2018")

comp_long <- compare %>%
  gather(key = "variable", value = "value", -site, -ind, -date, -depth, -fertile) 

# figure 2 
# visualising data 
ggplot(data = comp_long, aes(x = site, y = value)) +
  geom_boxplot(aes(colour = depth), notch = TRUE) +
  facet_wrap(~ variable, scales = "free") +
  labs(title = "Fig 2: A comparison of the morphology of _E. maxima_ collected from three sites, at three different depths. (deep/adult collected at 1m depth, shallow/adult and shallow/juvenile collected at the shoreline)") +
  theme_classic()

```

Both deep and shallow adult kelp show morphological variation between St James North and St James South for all variables, however the differences are not significant. However, all morphological variables of shallow kelp collected at Kalk Bay is significantly larger than that of adult kelp collected at 1m. Juvenile kelp at all sites is significantly different in primary width, stipe circumference, stipe length, stipe mass and total length. 


Comparing the morphology of _E.maxima_ at 1m and 7m depths:
```{r}
# load deep water data with required sites 
deep <- read_csv("data/trial.csv")

df.deep <- deep %>% 
  select(date:fertile)

deep.std <- deep %>% 
  select(-date, -site, -depth, -ind, -fertile)

# replacing NA values with 0 
deep.std[is.na(deep.std)] <- 0
  
deep.stand <- decostand(deep.std, method = "standardize")

combine <- cbind(deep.stand, df.deep)

comb_long <- combine %>%
  group_by(site) %>% 
  gather(key = "variable", value = "value", -site, -ind, -date, -depth, -fertile) 

# remove Kalk Bay
rm.kb <- combine[c(-12:-25, -152:-192),]

# remove millers point 
rm.mp <- rm.kb[c(-1:-11, -73:-114 ),]

site_long <- rm.mp %>%
  group_by(site) %>% 
  gather(key = "variable", value = "value", -site, -ind, -date, -depth, -fertile)  

# figure 3
ggplot(data = site_long, aes(x = site, y = value)) +
  geom_boxplot(aes(colour = depth), notch = TRUE) +
  facet_wrap(~ variable, scales = "free") +
  labs(title = "Fig 3: Morphology of E. Maxima collected at different depths. (deep/adult collected at 1m , deepest/adult collected at 7m)") +
  theme_classic()

```
The general pattern observed from this figure, shows that kelp collected at 7m deep is larger for all variables than those collected at 1m deep. Kommetjie and Soetwaterdisplay significantly different values between depths for all variables. Buffels bay specimens are only significant in stipe length, stipe mass, frond mass and number of tufts. Oudekraal differs significantly only in stipe length and stipe mass.

Comparing the morphology of _E. maxima_ at Miller's Point at 1m and 7m depths:
```{r}

mp_deep <- comb_long %>% 
  filter(site == "Miller's Point")

mp_shallow <- comb_long %>% 
  filter(date == "04-05-2018")

mp <-  rbind(mp_deep, mp_shallow)

# figure 4 
ggplot(data = mp, aes(x = site, y = value)) +
  geom_boxplot(aes(colour = depth), notch = TRUE) +
  facet_wrap(~ variable, scales = "free") +
  labs( title = "Fig4: Morphological variables of _E. Maxima_ collected at Miller’s Point at 1m and 7m depths (deep/adult collected at 1m, deepest/adult collected at 7m)") +
  theme_classic()

```
Adult E,maxima growing at depths of 7m at Miller’s Point, differs only from 1m adults in frond length, stipe length, stipe mass, total length and number of tufts, with all these variables being larger than that of kelp collected at 1m. Sites A, B and C show no significant differences in any of the morphological variables. 


Comparing Kalk Bay at four different depths:
```{r}

kb <- comb_long %>% 
  filter(site == "Kalk_Bay")

# figure 5 
ggplot(data = kb, aes(x = site, y = value)) +
  geom_boxplot(aes(colour = depth), notch = TRUE) +
  facet_wrap(~ variable, scales = "free") +
  labs(title = "Fig5: morphology of E. Maxima collected at Kalk Bay at different depths (deep/adult collected at 1m , deepest/adult collected at 7m, shallow/adult and shallow/juvenile collected along the shoreline)") +
  theme_classic()

```
Kelp found at 7m depth have a larger variability, but are not really significantly different from adult kelp in shallower water, except for stipe length, stipe mass, total length and number of tufts. Adult kelp collected in 1m deep water are more similar in morphology to juvenile kelp collected at the shoreline. 


Temperature Climatology 
```{r}
library(tidyverse)
library(ggpubr)
library(dplyr)
library(lubridate)
library(gridExtra)
library(stringr)
library(broom)
library(purrr)
library(circular)
library(zoo) # format date 

# load temperature data 
load("D:/honours/honours-project/data/SACTN_monthly_v4.2.Rdata")

# create site data frame
sites <-  c("Muizenberg", "Muizenberg", "Muizenberg", "Kalk Bay", "Miller's Point", "Miller's Point", "Miller's Point", "Bordjies", "Buffelsbaai", "Kommetjie", "Kommetjie", "Kommetjie","Kommetjie", "Oudekraal", "Oudekraal", "Yzerfontein")

# separate index into site and source, and replace sites with the new sites df
temps <- SACTN_monthly_v4.2 %>% 
  separate(index, c("site", "source"), "/") %>% 
  filter(site %in% sites)


# managing site names 
# temp sites replicated instead of interpolated, sites in closest proximity to one another will use same temp data
# rename temp site names with wave sites name, in order for it to match to perform RDA 

unique(temps$site)

temp_monthly <- temps %>% 
  mutate(date = lubridate::month(date, label = TRUE)) %>% 
  group_by(site, date) %>% 
  summarise(mean_temp = mean(temp, na.rm = T),
            min_temp = min(temp, na.rm = T),
            max_temp = max(temp, na.rm = T),
            range_temp = range(temp, na.rm = T)[2]-range(temp, na.rm = T)[1],
            sd_temp = sd(temp, na.rm = T)) %>%
  filter(date %in% c("Jan", "Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")) %>% 
  ungroup()

# oudekraal rep for bakoven 
oude <- temp_monthly %>% 
  filter(site == "Oudekraal") 

oudekraal <- oude

oude$newcolumn<-"Bakoven"
colnames(oude)[colnames(oude)=="newcolumn"] <- "site"
bakoven <-  oude[,-1]

# Kommetjie for slangkop, Soetwater and Olifantsbos
kom <- temp_monthly %>% 
  filter(site == "Kommetjie") 

#kommetjie
Kom <- kom

#slangkop
kom$newcolumn<-"Slangkop"
colnames(kom)[colnames(kom)=="newcolumn"] <- "site"
slangkop <-  kom[,-1]

#soetwater 
kom$newcolumn <- "Soetwater"
colnames(kom)[colnames(kom)=="newcolumn"] <- "site"
soet<-  kom[,-1]
soetwater <- soet[,-7]

# Olifantsbos 
kom$newcolumn <- "Olifantsbos"
colnames(kom)[colnames(kom)=="newcolumn"] <- "site"
oli <- kom[,-8:-9]
Olifantsbos <- oli[,-1]

#bordjies for Black rocks 
bord <- temp_monthly %>% 
  filter(site == "Bordjies") 

bord$newcolumn<-"Black_rocks"
colnames(bord)[colnames(bord)=="newcolumn"] <- "site"
black_rocks <-  bord[,-1]

# Buffelsbaai rename to Buffels 
buff <- temp_monthly %>% 
  filter(site == "Buffelsbaai") 

buff$newcolumn<-"Buffels"
colnames(buff)[colnames(buff)=="newcolumn"] <- "site"
buffels <-  buff[,-1]

# Miller`s Point for millers A, B and C
millers <- temp_monthly %>% 
  filter(site == "Miller's Point") 

millers$newcolumn<-"Millers_A"
colnames(millers)[colnames(millers)=="newcolumn"] <- "site"
millers_A <-  millers[,-1]

# millers B
millers$newcolumn<-"Millers_B"
colnames(millers)[colnames(millers)=="newcolumn"] <- "site"
mill_B <-  millers[,-1]
millers_B <- mill_B[,-7]

# millers C
millers$newcolumn<-"Millers_C"
colnames(millers)[colnames(millers)=="newcolumn"] <- "site"
mill_C <-  millers[,-8:-9]
millers_C <- mill_C[,-1]

#Muizenberg for St James N 
muiz <- temp_monthly %>% 
  filter(site == "Muizenberg") 

muiz$newcolumn<-"St_James_N"
colnames(muiz)[colnames(muiz)=="newcolumn"] <- "site"
st_james_N <-  muiz[,-1]

# kalk bay for St James, and St James S
kalk <- temp_monthly %>% 
  filter(site == "Kalk Bay") 

# change kalk bay name 
kalk$newcolumn<-"Kalk_Bay"
colnames(kalk)[colnames(kalk)=="newcolumn"] <- "site"
Kalk_Bay <-  kalk[,-1]

# St JAmes 
kalk$newcolumn<-"St_James"
colnames(kalk)[colnames(kalk)=="newcolumn"] <- "site"
St_J <-  kalk[,-1]
St_James <- St_J[,-7]

# St JAmes S 
kalk$newcolumn<-"St_James_S"
colnames(kalk)[colnames(kalk)=="newcolumn"] <- "site"
St_J_S <-  kalk[,-8:-9]
St_James_S <- St_J_S[,-1]

# yzer 
yzer <- temp_monthly %>% 
  filter(site == "Yzerfontein")

# create new temp df with data for all sites 
monthly_temp <- rbind(bakoven, black_rocks, buffels, Kalk_Bay, Kom, millers_A, millers_B, millers_C, Olifantsbos, oudekraal, slangkop, soetwater, St_James, st_james_N, St_James_S, yzer)
                
# temp annual 
ann_temp <-  monthly_temp %>% 
  group_by(site) %>% 
  gather(key = statistic, value = value, 
         mean_temp:sd_temp) %>% 
  mutate(clim_stat = paste(date, statistic, sep = "_")) %>% 
  select(-date, -statistic) %>% 
  spread(key = clim_stat, value = value)


```

Wind and Wave Climatology 
```{r}
library(ade4)
library(vegan)
library(gclus)
library(ape)
library(FactoMineR)

# WAVE CLIMATOLOGY

# writing a function for extraction of wave data 
load_wave <- function(wave_files) {
  site_name <- sapply(strsplit(as.character(wave_files), "/"), "[[", 3)
  site_info <- sapply(strsplit(as.character(wave_files), "/"), "[[", 4)
  site_info <- sapply(strsplit(site_info, ".txt"), "[[", 1)
  site_info <- strsplit(site_info, "_")
  site_depth <- sapply(site_info, "[[", 1)
  site_num <- sapply(site_info, "[[", 2)
  
  wave <- read_table(wave_files, col_types = c("dddddd"),
                     col_names = c("date", "hs", "tp", "dir", "dirw", "spw")) %>%
    filter(tp != -999) %>%
    mutate(date = as.POSIXct(as.character(date), "%Y%m%d%H%M", tz = "Africa/Johannesburg")) %>%
    mutate(site = site_name,
           num = site_num,
           depth = site_depth) %>%
    select(site, num, depth, everything()) %>% 
    na.omit()
  return(wave)
}

#  column names: date, wave height, wave period, wave direction, wind direction, wind speed

# loading wave data of selected sites 
Bakoven <- map_dfr(dir("data/wave_data/Bakoven", 
                       full.names = TRUE, pattern = "*.txt"), load_wave)
Black_rocks <- map_dfr(dir("data/wave_data/Black_rocks", 
                           full.names = TRUE, pattern = "*.txt"), load_wave)
Buffels <- map_dfr(dir("data/wave_data/Buffels", 
                       full.names = TRUE, pattern = "*.txt"), load_wave)
Kalk_bay <- map_dfr(dir("data/wave_data/Kalk_Bay", 
                        full.names = TRUE, pattern = "*.txt"), load_wave)
Kommetjie <- map_dfr(dir("data/wave_data/Kommetjie", 
                         full.names = TRUE, pattern = "*.txt"), load_wave)
Millers_A <- map_dfr(dir("data/wave_data/Millers_A", 
                         full.names = TRUE, pattern = "*.txt"), load_wave)
Millers_B <- map_dfr(dir("data/wave_data/Millers_B", 
                         full.names = TRUE, pattern = "*.txt"), load_wave)
Millers_C <- map_dfr(dir("data/wave_data/Millers_C", 
                         full.names = TRUE, pattern = "*.txt"), load_wave)
Olifantsbos <- map_dfr(dir("data/wave_data/Olifantsbos", 
                           full.names = TRUE, pattern = "*.txt"), load_wave)
Oudekraal <- map_dfr(dir("data/wave_data/Oudekraal", 
                         full.names = TRUE, pattern = "*.txt"), load_wave)
Slangkop <- map_dfr(dir("data/wave_data/Slangkop", 
                        full.names = TRUE, pattern = "*.txt"), load_wave)
Soetwater <- map_dfr(dir("data/wave_data/Soetwater", 
                         full.names = TRUE, pattern = "*.txt"), load_wave)
St_James <- map_dfr(dir("data/wave_data/St_James", 
                        full.names = TRUE, pattern = "*.txt"), load_wave)
St_James_N <- map_dfr(dir("data/wave_data/St_James_N", 
                          full.names = TRUE, pattern = "*.txt"), load_wave)
St_James_S <- map_dfr(dir("data/wave_data/St_James_S", 
                          full.names = TRUE, pattern = "*.txt"), load_wave)
Yzerfontein <- map_dfr(dir("data/wave_data/Yzerfontein", 
                           full.names = TRUE, pattern = "*.txt"), load_wave)


# combine sites into one df
wave_data <- rbind(Bakoven, Black_rocks, Buffels, Kalk_bay, Kommetjie, Millers_A, Millers_B, Millers_C, 
                   Olifantsbos, Oudekraal, Slangkop, Soetwater, St_James, St_James_N, St_James_S, Yzerfontein) 


rm(Bakoven, Black_rocks, Buffels, Kalk_bay, Kommetjie, Millers_A, Millers_B, Millers_C, 
   Olifantsbos, Oudekraal, Slangkop, Soetwater, St_James, St_James_N, St_James_S, Yzerfontein)

# removing number, depth and date columns 
wave <- wave_data[,-2:-4]

# Annual climatology for the wave data
wave_env <- wave %>% 
  group_by(site) %>% 
  summarise_all(funs(mean = mean, sd = sd, min = min, max = max), na.rm = T) %>%
  ungroup() %>% 
  group_by(site) %>% 
  select(site, everything())

```

Morphometric and environmental data for RDA
```{r}
# create environmental dataset 

# merge monthly temp and wave data to make env data for the RDA 
try_env <- merge(wave_env, ann_temp, by = c("site"))

# remove columns with values = 0
env <- try_env[, colSums(try_env != 0) > 0]

# create morphological data for rda

# load in morphology data 
morph <- as.tibble(read_csv("D:/honours/honours-project/data/morph_update.csv")[, -14])

# create morph df with  numerical cols
morph_spe <- morph %>% 
  filter(depth == "deep/adult") %>% 
  select(-date, -ind, -fertile)

# summarize morph 
sum.morph <- morph_spe %>%
  group_by(as.factor(site), depth) %>%   
  summarise(mn_fr_mass = mean(frond_mass), 
            sd_fr_mass = sd(frond_mass),
            mn_pri_len = mean(primary_length),
            sd_pri_len = sd(primary_length), 
            mn_pri_wid = mean(primary_width),
            sd_pri_wid = sd(primary_width), 
            mn_fr_len = mean(frond_length),
            sd_fr_len = sd(frond_length),
            mn_st_mass = mean(stipe_mass),
            sd_st_mass = sd(stipe_mass), 
            mn_st_len = mean(stipe_length),
            sd_st_len = sd(stipe_length), 
            mn_st_circ = mean(stipe_circ), 
            sd_st_circ = sd(stipe_circ),
            mn_tufts = mean(tufts), 
            sd_tufts = sd(tufts),
            mn_total_len = mean(total_length), 
            sd_total_len = sd(total_length))

# rmeoving site and depth columns 
spe <- sum.morph[,-1:-2]

```

### RDA 

```{r}

# Hellinger-transform the species dataset
morph.hel <- as.tibble(decostand(spe, "hellinger"))
morph.hel

# run RDA 
(morph.rda <- rda(morph.hel ~ ., env))

#total inertia constrained axis (RDA)
sum(morph.rda$CCA$eig)

# total inertia unconstrained axis (PC)
sum(morph.rda$CA$eig)

summary(morph.rda)	# Scaling 2 (default)

# Canonical coefficients from the rda object
coef(morph.rda)
# env components displays as NA ???

# Unadjusted R^2 retrieved from the rda object
(R2 <- RsquareAdj(morph.rda)$r.squared)
# Adjusted R^2 retrieved from the rda object
(R2adj <- RsquareAdj(morph.rda)$adj.r.squared) #report this value 

## Triplots of the rda results (wa scores)
## Site scores as weighted averages (vegan's default)
# Scaling 1: distance triplot
dev.new(title="RDA scaling 1 + wa")
plot(morph.rda, scaling=1, 
     main="Triplot RDA morph.hel ~ try.env - scaling 1 - wa scores")
spe.sc1 <- scores(morph.rda, choices=1:2, scaling=1, display="sp")
arrows(0, 0, spe.sc1[, 1]*0.92, spe.sc1[, 2]*0.92, length=0, lty=1, col="red")

# Scaling 2 (default): correlation triplot
dev.new(title="RDA scaling 2 + wa")
plot(morph.rda, main="Triplot RDA morph.hel ~ try.env - scaling 2 - wa scores")
spe.sc2 <- scores(morph.rda, choices=1:2, display="sp")
arrows(0, 0, spe.sc2[, 1]*0.92, spe.sc2[, 2]*0.92, length=0, lty=1, col="red")

## Triplots of the rda results (lc scores)
## Site scores as linear combinations of the environmental variables
# Scaling 1
dev.new(title="RDA scaling 1 + lc")
plot(morph.rda, scaling=1, display=c("sp", "lc", "cn"), 
     main="Triplot RDA morph.hel ~ try.env - scaling 1 - lc scores")
arrows(0, 0, spe.sc1[, 1]*0.92, spe.sc1[, 2]*0.92, length=0, lty=1, col="red")

# Scaling 2
dev.new(title="RDA scaling 2 + lc")
plot(morph.rda, display=c("sp", "lc", "cn"), 
     main="Triplot RDA morph.hel ~ try.env - scaling 2 - lc scores")
arrows(0, 0, spe.sc2[,1]*0.92, spe.sc2[,2]*0.92, length=0, lty=1, col="red")


# testing hypothesis
#  H0:the env is not having an effect
# H1: the env is having an effect

# Global test of the RDA result
anova(morph.rda, permutations=how(nperm=999))
# no p-value

# which axes are NB 
# Tests of all canonical axes
anova(morph.rda, by="axis", permutations=how(nperm=999))

#which env variables are responsible in influencing the landscape of spp? 
anova(morph.rda, by="term", permutations=how(nperm=999))


# Variance inflation factors (VIF) (extracts colinearity)
vif.cca(morph.rda)
# again env components not showing values 
# exclude certain variables then run again 
# no exact answer, dependent on ur argument 

# Apply Kaiser-Guttman criterion to residual axes
morph.rda$CA$eig[morph.rda$CA$eig > mean(morph.rda$CA$eig)]


```

\newpage
## Discussion

In this study, we aimed to determine how, or rather which aspects of temperature and wave parameters influence the morphology of E. maxima in shallow water. Sporophytes of E. Maxima were collected in the central parts of its geographical range, at sites with variable temperature and wave exposure regimes. Previous studies have shown that temperature is a driver of the geographic distribution of most marine organisms, including kelp (Bolton 2010). However, there is a strong consensus among biologists, that wave action is responsible for the morphological variation found within kelps (Gerard and Mann, 1979, Molloy and Bolton, 1996, Hurd, 2000, Wernberg and Thomsen, 2005).  Our results show that wave parameters are the most influential aspects of morphological variation within E. Maxima, especially (insert most important parameters). 

###Morphology

After thorough analysis between kelps in exposed and sheltered sites, Fowler-Walker, Wernberg and Connell (2006) determined that morphological variation is a plastic trait, which kelps have developed in response to their local environment. When comparing morphological variables among sites, it is evident that there are clear patterns distinguishing False Bay sites, to those along the West Coast. Primary blade length and stipe length are two variables where these patterns are clearly visible (figure 1). Sites in the False Bay region generally have shorter primary blades and, longer stipe lengths. This could be in response to environmental conditions, as False Bay is more exposed to the prevailing south easterly winds, resulting in more extreme wave action.  Longer stipes allows kelp to be more flexible in high wave action environments (). Shorter and fewer secondary blades (figure 1: number of tufts) help decrease drag forces and prevent breakage (Johnson and Koehl, 1994, Blanchette et al. 2002) and dislodgement. Kelps in sheltered localities, along the West Coast show similar trends to studies done by Gerard and Mann (1979), Wheeler (1980) and Fowler-Walker, Wernberg and Connell (2006), where kelp sporophytes have adapted to (high/low temp and weaker wave action unique to these areas) by increasing the surface area of their secondary fronds to maximise nutrient uptake and receive optimal light for photosynthesis. 


\newpage
## Conclusions

## Ackknowledgements

Firstly I would like to thank my supervisor, Prof. AJ Smit, for guiding me through this year, and for sharing his extensive knowledge of kelp and love for R with me. To Ross Coppin, my co-supervisor, for all the pointers and words of encouragement when things got too much. A big thank you to Team Kelp, for sacrificing your valuable time to help me with sampling, obtaining the temperature and wave data as well as the R analyses, it is greatly appreciated. A special thank you to Carlin Landsberg and Amieroh Abrahams, you ladies have made this honours journey so much more bearable and a lot of fun, especially when we were seeing geom_flames. Thank you to my family and friends, for their unfailing love and support, and words of encouragement. Thank you to the Department of Biodiversity and Conservation Biology at the University of the Western Cape; especially the honours class of 2018, it has been an honour being around such enthusiastic biologists. Finally, to the NRF for providing me with funding to complete this project. 

\newpage
## References 
